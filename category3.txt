===== app\api\v1\users.py =====
from fastapi import APIRouter, Depends
from app.core.deps import get_current_user, require_role

from app.models.user import User

router = APIRouter(prefix="/users", tags=["users"])


@router.get("/me")
def read_current_user(
    current_user: User = Depends(get_current_user),
):
    return {
        "id": current_user.id,
        "email": current_user.email,
    }


===== app\routers\admin.py =====
from fastapi import APIRouter, Depends, HTTPException, status
from app.core.deps import get_current_user
from app.models.user import User

router = APIRouter(prefix="/admin", tags=["admin"])


@router.get("/dashboard")
def admin_dashboard(current_user: User = Depends(get_current_user)):
    if not any(role.name == "admin" for role in current_user.roles):
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN, detail="Forbidden: role mismatch"
        )
    return {"msg": "Welcome admin"}


===== app\routers\tenant_dashboard.py =====
from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session

from app.core.database import get_db
from app.core.deps import get_current_user, get_current_tenant
from app.models.user import User
from app.models.tenant import Tenant
from app.services import tenant_service

router = APIRouter(prefix="/tenants", tags=["tenants"])


@router.get("/dashboard", status_code=200)
def tenant_dashboard(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user),
    tenant: Tenant = Depends(get_current_tenant),
):
    return tenant_service.get_dashboard_data(db, tenant, current_user)


===== app\main.py =====
from fastapi import FastAPI

app = FastAPI(title="Secure Multi-Tenant Backend", version="0.1.0")

# ایمپورت روترها
from app.api.v1.auth import router as auth_router
from app.api.v1.users import router as users_router
from app.routers.admin import router as admin_router
from app.routers.tenant_dashboard import router as tenant_dashboard_router

# اضافه کردن روترها
app.include_router(auth_router, prefix="/auth", tags=["auth"])
app.include_router(users_router, prefix="/users", tags=["users"])
app.include_router(tenant_dashboard_router)  # اینجا اضافه شد
app.include_router(admin_router, prefix="/admin", tags=["admin"])


@app.get("/health", tags=["health"])
def health_check():
    return {"status": "ok"}


